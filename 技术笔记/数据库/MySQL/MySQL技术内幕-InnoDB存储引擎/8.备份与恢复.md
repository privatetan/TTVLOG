# 备份与恢复

## 一、备份与恢复

### 1）备份分类

######  根据备份类型分类：

- Hot Backup：热备
- Cold Backup：冷备
- Warm Backup：温备

|  备份类型   |     备份时机     |                    备份影响                     |
| :---------: | :--------------: | :---------------------------------------------: |
| Hot Backup  | 数据库运行时备份 |                 对数据库无影响                  |
| Cold Backup | 数据库停止时备份 |   仅复制相关数据库物理文件<br/>对数据库无影响   |
| Warm Backup | 数据库运行时备份 | 对数据库有影响<br/>如加全局锁保证备份数据一致性 |

###### 根据备份后文件分类：

- 逻辑备份
- 裸文件备份

|  备份类型  |             备份内容              |                  特点                   |
| :--------: | :-------------------------------: | :-------------------------------------: |
|  逻辑备份  | 文本文件，内容是SQL语句或表内数据 | 适合数据库升级、迁移工作<br/>恢复时间长 |
| 裸文件备份 |     复制备份数据库的物理文件      |               恢复时间短                |

###### 根据备份数据库内容分类：

- 完全备份
- 增量备份
- 日志备份

| 备份类型 |    备份内容    |                       备份实现                       |
| :------: | :------------: | :--------------------------------------------------: |
| 完全备份 | 数据库完整备份 |                                                      |
| 增量备份 | 更新的数据备份 | 记录当前每页检查点的LSN<br>然后与之前备份的LSN做比较 |
| 日志备份 | 二进制日志备份 |                                                      |

对于增量备份，官方没有提供真正的增量备份方法，大部分是通过二进制日志完成增量备份的工作。

### 2）一致性备份

要求在备份的时候，数据在这一时间点上是一致的。

对于InnoDB来说，在隔离级别RR下，由于支持MVCC，是完美支持一致性备份的。

对于mysqldump备份工具来说，通过添加 --single-transaction选项获得InnoDB的一致性备份。

### 3）备份建议

###### 备份监控程序

根据自己需要开发一套备份监控应用程序，在完成备份工作的同时，实时监控数据库状态、系统状态和硬件状态，发生故障后立即通知相关人员。

###### 容灾

做好远程异地备份，即容灾防范。



## 二、冷备

### 1）冷备

InnoDB的冷备，在数据库停止时备份，需备份的文件有：

- MySQL数据库的frm文件
- 共享表空间文件
- 独立表空间文件（idb）
- 重做日志文件

通常会使用**脚本**来完成冷备操作，冷备关键在于，不能遗漏需要备份的物理文件，避免数据库因缺少备份文件而无法启动。

应该将产生的备份文件备份一份到远程服务器，实现灾备。

### 2）冷备的优缺点

###### 优点：

- 备份简单，仅复制相关文件即可；
- 备份文件方便与在不同操作系统、不同MySQL版本上完成恢复；
- 恢复简单，仅需把文件恢复到指定位置即可；
- 恢复速度快，不需要执行SQL语句，也无需重建索引。

###### 缺点：

- 冷备文件通常比逻辑文件大很多，因为表空间存放很多其他数据，如undo段、插入缓冲等；
- 冷备跨平台可能会有问题，操作系统、MySQL版本，文件大小写敏感等都会成为问题

## 三、逻辑备份



## 四、二进制日志备份与恢复



## 五、热备



## 六、快照备份



## 七、复制