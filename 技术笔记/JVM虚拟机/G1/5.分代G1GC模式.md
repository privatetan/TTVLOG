# 分代G1GC模式

G1GC存在两种GC模式

- 纯G1GC模式
- 分代G1GC模式

纯G1GC模式：垃圾优先垃圾回收

分代G1GC模式：分代垃圾回收

## 分代G1GC特点

##### 与纯G1GC模式的不同点

- 区域是分代的
- 回收集合的选择是分代的

##### 区域划分

- 新生代区域
- 老年代区域

##### GC划分

- 完全新生代GC：新生代GC
- 部分新生代GC：老年代GC

两GC的主要区别在于回收集合的选择：

完全新生代GC，会将所有新生代区域选入回收集合；

部分新生代GC，会将所有新生代区域以及部分老年代区域选入回收集合。

两GC都会将所有新生代区域选入回收集合。



## 新生代区域

新生代还可以分为两部分

- ##### 创建区域

  存放刚创建的没有发生转移的对象；

- ##### 存活区域

  存放至少被转移过一次的对象。

**转移专用写屏障不会作用在新生代区域对象上**

因为在分代G1GC中，所有的新生代区域都会被选入回收集合，导致转移时所有对象引用都会被检查，所以新生代区域对象卡片不会记录在转移专用记忆集合中。



## 分代对象转移

年龄：存活对象保存了自己的转移次数；

晋升：年龄超过阈值，就会转移到老年代，称为晋升。



## 新生代GC执行过程

##### 完全新生代 GC

只会将所有新生代区域都选入回收集合，然后转移回收集合内的存活对象。

晋升的对象会被转移到老年代区域，其余对象则被转移到存活区域。

##### 部分新生代 GC

所有新生代区域外，及部分老年代区域选入回收集合，然后转移回收集合内的存活对象。

除了回收集合的选择方式，部分新生代 GC 和完全新生代 GC 的执行过程是一样的。



## 最大新生代区域数

**最大新生代区域数** ， 解决因新生代区域数太多，可能无法遵守用户设置的 GC 暂停时间上限，导致违反软实时性问题。

**最大新生代区域数计算方法**

- 完全新生代GC：在遵守 GC 暂停时间上限的前提下，尽量设置较大的值；
- 部分新生代GC：在遵守 GC 单位时间的前提下，尽量设置较小的值。



## GC切换