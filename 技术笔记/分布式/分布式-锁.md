# 分布式-锁

## 一、分布式锁

### 锁

单体应用本地锁：Synchronizd、ReentrantLock；

分布式应用分布式锁：分布式应用中，可以把每个应用看成是一个线程，分布式锁，就是为了解决分布式应用处理资源时的并发安全问题。

**锁作用**：保证并发安全、避免重复处理。

### 分布式锁的功能

- 互斥性：基本功能，一个应用获取锁，另一个应用则获取不到锁；

- 可重入性：一个应用获取锁之后还能再次获取该锁（幂等性：多次持有锁的处理结果一致）；

- 锁超时：应用持有的锁超时后，一定时间后自动释放锁；

- 支持阻塞/非阻塞：获取锁是否需要等待

- 支持公平/非公平锁：获取锁的是否有先后顺序；

- 高效：加/释放锁速度要快；

- 高可用：分布式锁的可用性；

  

## 二、分布式锁实践

- 数据库分布式锁
- Zookeeper分布式锁
- Chubby分布式锁
- Etcd分布式锁
- Redis分布式锁

### 数据库分布式锁

#### 实现

1. ##### 维护资源分布式锁表

   ```mysql
   create table resource_lock(
      'lock_id' int unsigned NOT NULL AUTO_INCREMENT,
      'lock_key' varchar(128) NOT NULL default '' COMMENT '锁资源',
      'node_info' varchar(128) NOT NULL default '' COMMENT '节点/线程信息',
      'reentrant_count' varchar(128) NOT NULL default '0' COMMENT '重入次数',
      'create_time' timestamp NULL default NULL COMMENT '创建时间',
      'update_time' timestamp NULL default NULL COMMENT '更新时间',
     primary key('lock_id'),
     Unique key 'unique_lock_key' ('lock_key') 
   )ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='分布式锁表'
   ```

2. ##### 在资源表增加分布式锁字段

